(self.webpackChunkscriptcat_org=self.webpackChunkscriptcat_org||[]).push([[424],{2729:(n,s,a)=>{"use strict";a.r(s),a.d(s,{data:()=>e});const e={key:"v-393a8250",path:"/dev/background.html",title:"后台脚本",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"后台脚本",slug:"后台脚本-1",children:[]},{level:2,title:"定时脚本",slug:"定时脚本",children:[{level:3,title:"Crontab 例子",slug:"crontab-例子",children:[]}]},{level:2,title:"脚本调试",slug:"脚本调试",children:[]},{level:2,title:"Promise",slug:"promise",children:[]}],filePathRelative:"dev/background.md",git:{updatedTime:1630653537e3,contributors:[]}}},2311:(n,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>H});var e=a(6252);const t=a.p+"assets/img/image-20210903141601057.f338978a.png",m=a.p+"assets/img/image-20210903144155450.40b0f1bf.png",c=(0,e.Wm)("h1",{id:"后台脚本",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#后台脚本","aria-hidden":"true"},"#"),(0,e.Uk)(" 后台脚本")],-1),o=(0,e.Wm)("blockquote",null,[(0,e.Wm)("p",null,"后台脚本适用于持续运行类型的脚本.后台脚本是脚本猫特有的脚本.")],-1),l=(0,e.Wm)("h2",{id:"后台脚本-1",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#后台脚本-1","aria-hidden":"true"},"#"),(0,e.Uk)(" 后台脚本")],-1),p=(0,e.Wm)("p",null,[(0,e.Uk)("后台脚本由"),(0,e.Wm)("code",null,"@background"),(0,e.Uk)("属性声明,后台脚本将允许在开启脚本或者浏览器启动后,让脚本在后台持续运行.")],-1),r=(0,e.Wm)("h2",{id:"定时脚本",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#定时脚本","aria-hidden":"true"},"#"),(0,e.Uk)(" 定时脚本")],-1),W=(0,e.Wm)("blockquote",null,[(0,e.Wm)("p",null,"定时脚本也属于后台脚本的一种,定时脚本适用于每隔一段时间执行一次的脚本.")],-1),u=(0,e.Wm)("p",null,[(0,e.Uk)("定时脚本由"),(0,e.Wm)("code",null,"@crontab"),(0,e.Uk)("属性声明,可以精确到秒级调用,提供了一个"),(0,e.Wm)("code",null,"once"),(0,e.Uk)("参数,表示某个时间段内会执行一次(考虑浏览器未打开的情况).建议脚本的运行时间和重试时间不要大于定时时间的间隔.")],-1),k=(0,e.Uk)("可使用在线工具测试crontab表达式,扩展中的"),i=(0,e.Wm)("code",null,"once",-1),b=(0,e.Uk)("替换成"),U=(0,e.Wm)("code",null,"*",-1),d=(0,e.Uk)(":"),h={href:"https://tool.lu/crontab/",target:"_blank",rel:"noopener noreferrer"},g=(0,e.Uk)("crontab在线测试"),f=(0,e.Wm)("p",null,[(0,e.Uk)("在控制台页面,鼠标放置"),(0,e.Wm)("code",null,"运行状态"),(0,e.Uk)("栏时会显示下一次的运行时间.")],-1),v=(0,e.Wm)("h3",{id:"crontab-例子",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#crontab-例子","aria-hidden":"true"},"#"),(0,e.Uk)(" Crontab 例子")],-1),w=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"//@crontab * * * * * * 每秒运行一次"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"//@crontab * * * * * 每分钟运行一次"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"//@crontab 0 */6 * * * 每6小时的0分时执行一次"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"//@crontab 15 */6 * * * 每6小时的15分时执行一次"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"//@crontab * once * * * 每小时运行一次"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"//@crontab * * once * * 每天运行一次"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"//@crontab * 10 once * * 每天10点检测运行一次"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"//@crontab * 10-23 once * * 每天10点后检测运行一次"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"//@crontab * once 13 * * 每个月13号中的每小时最多运行一次"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br")])],-1),y=(0,e.Wm)("h2",{id:"脚本调试",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#脚本调试","aria-hidden":"true"},"#"),(0,e.Uk)(" 脚本调试")],-1),j=(0,e.Wm)("p",null,"后台脚本可直接在脚本编辑页面进行调试",-1),x=(0,e.Wm)("p",null,[(0,e.Wm)("img",{src:t,alt:""})],-1),P=(0,e.Wm)("p",null,[(0,e.Uk)("如果是运行的环境请前往扩展开启"),(0,e.Wm)("strong",null,"开发人员模式"),(0,e.Uk)("然后在点击扩展的background.html进行调试，运行时产生的错误也可以在运行日志中查看")],-1),z=(0,e.Wm)("p",null,[(0,e.Wm)("img",{src:m,alt:"image-20210903144155450"})],-1),C=(0,e.Wm)("h2",{id:"promise",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#promise","aria-hidden":"true"},"#"),(0,e.Uk)(" Promise")],-1),M=(0,e.Wm)("blockquote",null,[(0,e.Wm)("p",null,"十分推荐这种写法,也便于脚本管理器的脚本监控")],-1),S=(0,e.Wm)("p",null,[(0,e.Uk)("脚本返回"),(0,e.Wm)("code",null,"Promise"),(0,e.Uk)("对象,管理器可以将返回的内容当作日志记录下来.")],-1),q=(0,e.Wm)("div",{class:"language-typescript ext-ts line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-typescript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// ==UserScript=="),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// @name         后台脚本"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// @namespace    wyz"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// @version      1.0.0"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// @author       wyz"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// @background"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// ==/UserScript=="),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},[(0,e.Wm)("span",{class:"token builtin"},"Promise")]),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("resolve"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" reject"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("Math"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"round"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("Math"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"random"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"*"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token number"},"10"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"%"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token number"},"2"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function"},"resolve"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},'"ok"'),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},";"),(0,e.Wm)("span",{class:"token comment"},"// 执行成功"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"else"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function"},"reject"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},'"error"'),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},";"),(0,e.Wm)("span",{class:"token comment"},"// 执行失败,并返回错误原因"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br")])],-1),_=(0,e.Wm)("div",{class:"language-javascript ext-js line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-javascript"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token comment"},"// ==UserScript=="),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// @name         每天运行一次的定时脚本"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// @namespace    wyz"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// @version      1.0.0"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// @author       wyz"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// @crontab      * * once * *"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token comment"},"// ==/UserScript=="),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token keyword"},"return"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"new"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token class-name"},"Promise"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token parameter"},[(0,e.Uk)("resolve"),(0,e.Wm)("span",{class:"token punctuation"},","),(0,e.Uk)(" reject")]),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"=>"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token keyword"},"if"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("Math"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"round"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Uk)("Math"),(0,e.Wm)("span",{class:"token punctuation"},"."),(0,e.Wm)("span",{class:"token function"},"random"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"*"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token number"},"10"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token operator"},"%"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token number"},"2"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function"},"resolve"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},'"ok"'),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},";"),(0,e.Wm)("span",{class:"token comment"},"// 执行成功"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token keyword"},"else"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token punctuation"},"{"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token function"},"reject"),(0,e.Wm)("span",{class:"token punctuation"},"("),(0,e.Wm)("span",{class:"token string"},'"error"'),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},";"),(0,e.Wm)("span",{class:"token comment"},"// 执行失败,并返回错误原因"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token punctuation"},"}"),(0,e.Wm)("span",{class:"token punctuation"},")"),(0,e.Wm)("span",{class:"token punctuation"},";"),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br")])],-1),H={render:function(n,s){const a=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.j4)(e.HY,null,[c,o,l,p,r,W,u,(0,e.Wm)("p",null,[k,i,b,U,d,(0,e.Wm)("a",h,[g,(0,e.Wm)(a)])]),f,v,w,y,j,x,P,z,C,M,S,q,_],64)}}}}]);