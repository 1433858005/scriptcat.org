(self.webpackChunkscriptcat_org=self.webpackChunkscriptcat_org||[]).push([[188],{493:(n,s,a)=>{"use strict";a.r(s),a.d(s,{data:()=>e});const e={key:"v-4a914b38",path:"/dev/cron.html",title:"定时脚本",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"Crontab 例子",slug:"crontab-例子",children:[]},{level:2,title:"Promise",slug:"promise",children:[]}],filePathRelative:"dev/cron.md",git:{updatedTime:1629903006e3,contributors:[]}}},2196:(n,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>d});var e=a(6252);const p=(0,e.Wm)("h1",{id:"定时脚本",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#定时脚本","aria-hidden":"true"},"#"),(0,e.Uk)(" 定时脚本")],-1),t=(0,e.Wm)("blockquote",null,[(0,e.Wm)("p",null,"定时脚本也属于后台脚本的一种,定时脚本适用于每隔一段时间执行一次的脚本.")],-1),c=(0,e.Wm)("p",null,[(0,e.Uk)("定时脚本由"),(0,e.Wm)("code",null,"@crontab"),(0,e.Uk)("属性声明,可以精确到秒级调用,提供了一个"),(0,e.Wm)("code",null,"once"),(0,e.Uk)("参数,表示某个时间段内会执行一次(考虑浏览器未打开的情况).建议脚本的运行时间和重试时间不要大于定时时间的间隔.")],-1),o=(0,e.Uk)("可使用在线工具测试crontab表达式,扩展中的"),l=(0,e.Wm)("code",null,"once",-1),r=(0,e.Uk)("替换成"),u=(0,e.Wm)("code",null,"*",-1),i=(0,e.Uk)(":"),m={href:"https://tool.lu/crontab/",target:"_blank",rel:"noopener noreferrer"},k=(0,e.Uk)("crontab在线测试"),b=(0,e.uE)('<p>在控制台页面,鼠标放置<code>运行状态</code>栏时会显示下一次的运行时间.</p><h2 id="crontab-例子" tabindex="-1"><a class="header-anchor" href="#crontab-例子" aria-hidden="true">#</a> Crontab 例子</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//@crontab * * * * * * 每秒运行一次</span>\n<span class="token comment">//@crontab * * * * * 每分钟运行一次</span>\n<span class="token comment">//@crontab 0 */6 * * * 每6小时的0分时执行一次</span>\n<span class="token comment">//@crontab 15 */6 * * * 每6小时的15分时执行一次</span>\n<span class="token comment">//@crontab * once * * * 每小时运行一次</span>\n<span class="token comment">//@crontab * * once * * 每天运行一次</span>\n<span class="token comment">//@crontab * 10 once * * 每天10点检测运行一次</span>\n<span class="token comment">//@crontab * 10-23 once * * 每天10点后检测运行一次</span>\n<span class="token comment">//@crontab * once 13 * * 每个月13号中的每小时最多运行一次</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="promise" tabindex="-1"><a class="header-anchor" href="#promise" aria-hidden="true">#</a> Promise</h2><blockquote><p>十分推荐这种写法,也便于脚本管理器的脚本监控</p></blockquote><p>脚本返回<code>Promise</code>对象,管理器可以将返回的内容当作日志记录下来.</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// ==UserScript==</span>\n<span class="token comment">// @name         Promise测试demo</span>\n<span class="token comment">// @namespace    wyz</span>\n<span class="token comment">// @version      1.0.0</span>\n<span class="token comment">// @author       wyz</span>\n<span class="token comment">// @crontab * * * * *</span>\n<span class="token comment">// ==/UserScript==</span>\n<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 执行成功</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 执行失败,并返回错误原因</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div>',7),d={render:function(n,s){const a=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.j4)(e.HY,null,[p,t,c,(0,e.Wm)("p",null,[o,l,r,u,i,(0,e.Wm)("a",m,[k,(0,e.Wm)(a)])]),b],64)}}}}]);